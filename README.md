# Cosmodrom - Система симуляции запуска ракет

Комплексная система для симуляции запуска ракет на орбиту Земли с возможностью координации нескольких ракет одновременно и предотвращения столкновений.

## Архитектура

Проект состоит из нескольких компонентов на разных языках программирования:

### 1. Physics (C) - Физический движок
- Расчет физики полета ракеты
- Гравитация, сопротивление атмосферы, тяга двигателей
- Орбитальная механика
- Обнаружение столкновений с землей
- Библиотека: `librocket_physics.so`

### 2. Server (Go) - Сервер координации
- Координация нескольких ракет
- Обнаружение возможных столкновений
- WebSocket API для обмена данными
- HTTP endpoint для просмотра списка активных ракет

### 3. Client (Go + C(GO)) - Клиент-ракета
- Симуляция отдельной ракеты
- Использует физический движок через C(GO)
- Отправляет телеметрию на сервер в реальном времени
- Получает команды управления от сервера

### 4. Graphic (C++ + raylib) - Визуализация
*В процессе dudes*

## Установка и сборка

### Требования
- GCC или Clang (для C)
- Go 1.21+ (для Server и Client)
- Make

### Сборка

#### 1. Физический движок
```bash
cd Physics
make
```

Это создаст библиотеку `librocket_physics.so` и тестовую программу.

Для запуска тестов:
```bash
make test
```

#### 2. Сервер
```bash
cd Server
go build -o cosmodrom-server
```

#### 3. Клиент
```bash
cd Client
export CGO_LDFLAGS="-L../Physics -lrocket_physics"
export LD_LIBRARY_PATH="../Physics:$LD_LIBRARY_PATH"
go build -o cosmodrom-client
```

## Запуск

### 1. Запуск сервера

```bash
cd Server
./cosmodrom-server -port 8080
```

Сервер будет доступен на:
- WebSocket: `ws://localhost:8080/ws`
- HTTP API: `http://localhost:8080/rockets`
- Главная страница: `http://localhost:8080/`

### 2. Запуск клиента (ракеты)

В отдельном терминале:

```bash
cd Client
export LD_LIBRARY_PATH="../Physics:$LD_LIBRARY_PATH"
./cosmodrom-client \
  -server ws://localhost:8080/ws \
  -id rocket-001 \
  -name "Falcon Heavy" \
  -lat 45.0 \
  -lon 63.0 \
  -alt 100.0
```

Параметры:
- `-server` - URL сервера (по умолчанию `ws://localhost:8080/ws`)
- `-id` - Уникальный ID ракеты (по умолчанию генерируется случайно)
- `-name` - Название ракеты (по умолчанию "Test Rocket")
- `-lat` - Широта запуска в градусах (по умолчанию 45.0)
- `-lon` - Долгота запуска в градусах (по умолчанию 63.0)
- `-alt` - Высота над уровнем моря в метрах (по умолчанию 100.0)

### 3. Запуск нескольких ракет

Вы можете запустить несколько ракет одновременно в разных терминалах:

```bash
# Терминал 2 - Ракета 1
./cosmodrom-client -id rocket-001 -name "Popa1" -lat 45.0 -lon 63.0

# Терминал 3 - Ракета 2
./cosmodrom-client -id rocket-002 -name "Popa2" -lat 45.1 -lon 63.1

# Терминал 4 - Ракета 3
./cosmodrom-client -id rocket-003 -name "Popa3" -lat 44.9 -lon 62.9
```

Сервер будет отслеживать все ракеты и предупреждать о возможных столкновениях.

## Протокол обмена данными

Система использует WebSocket для обмена данными в формате JSON.

### Сообщения от клиента к серверу:

#### Register - Регистрация ракеты
```json
{
  "type": "register",
  "timestamp": "2024-01-20T10:00:00Z",
  "data": {
    "rocket_id": "rocket-001",
    "config": {
      "name": "Popa1",
      "mass_empty": 5000.0,
      "mass_fuel": 15000.0,
      "engines": [...],
      ...
    }
  }
}
```

#### Telemetry - Телеметрия
```json
{
  "type": "telemetry",
  "timestamp": "2024-01-20T10:00:01Z",
  "data": {
    "rocket_id": "rocket-001",
    "state": {
      "position": {"x": 0, "y": 0, "z": 6371100},
      "velocity": {"x": 0, "y": 0, "z": 100},
      "altitude": 1000.0,
      "speed": 100.0,
      "fuel_remaining": 14000.0,
      ...
    }
  }
}
```

### Сообщения от сервера к клиенту:

#### Accepted - Регистрация принята
```json
{
  "type": "accepted",
  "data": {
    "rocket_id": "rocket-001",
    "message": "Регистрация успешна"
  }
}
```

#### Warning - Предупреждение о столкновении
```json
{
  "type": "warning",
  "data": {
    "rocket_id": "rocket-001",
    "warning": "Опасное сближение с ракетой rocket-002!",
    "severity": "high"
  }
}
```

## Физическая модель

### Константы
- Радиус Земли: 6371 км
- Масса Земли: 5.972 * 10(24) кг
- Гравитационная постоянная: 6.674 * 10(-11) м3/(кг*с2)
- Первая космическая скорость: ~7900 м/с
- Граница атмосферы (линия Кармана): 100 км

### Силы
1. **Гравитация**: F = G * M * m / r2
2. **Сопротивление атмосферы**: F_drag = 0.5 * ρ * v2 * C_d * A
   - Плотность атмосферы убывает экспоненциально с высотой
3. **Тяга двигателей**: Управляется дросселями (0.0 - 1.0)

### Орбитальная механика
Ракета считается на стабильной орбите, если:
- Высота > 100 км (выше атмосферы)
- Скорость близка к орбитальной для данной высоты (±10%)

## Примеры использования

### Простой запуск
```bash
# Запустите сервер
cd Server && ./cosmodrom-server

# В другом терминале запустите клиента
cd Client && LD_LIBRARY_PATH=../Physics ./cosmodrom-client
```

### Просмотр активных ракет
```bash
curl http://localhost:8080/rockets | jq
```

### Запуск с разных координат
```bash
# Байконур
./cosmodrom-client -lat 45.965 -lon 63.305 -name "Popa1"

# Мыс Канаверал
./cosmodrom-client -lat 28.573 -lon -80.649 -name "Popa2"

# Куру (Французская Гвиана)
./cosmodrom-client -lat 5.239 -lon -52.768 -name "Popa3"
```

## Разработка

### Структура проекта
```
Cosmodrom/
├── Physics/              # Физический движок (C)
│   ├── rocket_physics.h
│   ├── rocket_physics.c
│   ├── test_physics.c
│   └── Makefile
├── Server/               # Сервер координации (Go)
│   ├── main.go
│   ├── protocol/
│   │   └── protocol.go
│   └── go.mod
├── Client/               # Клиент-ракета (Go + CGO)
│   ├── main.go
│   ├── physics/
│   │   └── physics_wrapper.go
│   ├── protocol/
│   │   └── protocol.go
│   └── go.mod
├── Graphic/              # Визуализация (C++ + raylib) [В процессе!]
└── README.md
```

## Будущие улучшения

- [ ] Графическая визуализация 3D с raylib
- [ ] Веб-интерфейс для создания и настройки ракет
- [ ] Более реалистичная модель атмосферы
- [ ] Многоступенчатые ракеты
- [ ] Ориентация ракеты (Эйлеровы углы)
- [ ] Посадка с использованием обратной тяги
- [ ] Сохранение истории полетов
- [ ] Replay функция

## Лицензия

MIT

## Авторы

Я крутой
